@if (dataSource().length === 0) {
  <div class="no-tests-message">No tests to display.</div>
} @else {
  <mat-tree #tree [dataSource]="dataSource()" [childrenAccessor]="childrenAccessor">
    <mat-tree-node
      *matTreeNodeDef="let node"
      matTreeNodePadding
      (click)="onNodeClick(node)"
      [class.clickable]="!!node.test"
      [class.selected]="isNodeSelected(node)">
      <button matIconButton disabled></button>
      <mat-icon [style.color]="getColor(node)">
        {{ getIcon(node) }}
      </mat-icon>
      <span class="node-label">{{ node.name }}</span>
      @if (node.test?.durationMs !== undefined) {
        <span class="node-duration" [matTooltip]="(node.test?.durationMs ?? 0) + 'ms'">
          ({{ node.test?.durationMs | humanizeDuration }})
        </span>
      }
    </mat-tree-node>

    <mat-tree-node
      *matTreeNodeDef="let node; when: hasChild"
      matTreeNodePadding
      matTreeNodeToggle
      [cdkTreeNodeTypeaheadLabel]="node.name">
      <button matIconButton matTreeNodeToggle [attr.aria-label]="'Toggle ' + node.name">
        <mat-icon>
          {{ tree.isExpanded(node) ? 'expand_more' : 'chevron_right' }}
        </mat-icon>
      </button>
      <mat-icon [style.color]="getColor(node)">
        {{ getIcon(node) }}
      </mat-icon>
      <span class="node-label">{{ node.name }}</span>
      @if (node.testCount !== undefined) {
        <app-test-count-display
          [colors]="colors()"
          [testCounts]="node.testCount"></app-test-count-display>
      }
      @if (node.totalDurationMs !== undefined) {
        <span class="node-duration" [matTooltip]="(node.totalDurationMs ?? 0) + 'ms'">
          ({{ node.totalDurationMs | humanizeDuration }})
        </span>
      }
    </mat-tree-node>
  </mat-tree>
}
